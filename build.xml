<?xml version="1.0"?>

<project name="freeguide-tv" default="main" basedir=".">

    <description>
        Ant build file for freeguide-tv
    </description>

	<!-- set global properties for this build -->
	<property name="src" location="src"/>
	<property name="doc"  location="doc"/>
	<property name="xmltv"  location="xmltv"/>
	<property name="share"  location="xmltv/share"/>
	<property name="build" location="build"/>
	<property name="dist"  location="dist"/>
    
	<property name="freeguideversion"  value="FreeGuide-0.8"/>

  	<target name="init">

    	<!-- Create the time stamp -->
    	<tstamp/>
    	<!-- Create the build directory structure used by compile -->
    	<mkdir dir="${build}"/>
		<mkdir dir="${build}/program"/>
		<mkdir dir="${build}/doc"/>
		<mkdir dir="${dist}"/>

	</target>
    
    <target name="install-Linux-NoXMLTV-files"
            description="install all the files for linux"
            depends="FreeGuide-Linux-NoXMLTV" >
        
        <!-- the install_share_dir property is passed in if we are doing
            an install - this will be /usr/share or equivalent -->
        <property name="install_jar_dir"
            location="${install_share_dir}/freeguide-tv" />
        <property name="install_doc_dir" location="${install_jar_dir}/doc" />
        <property name="install_pixmap_dir" location="${install_share_dir}/pixmaps/freeguide-tv" />
        
        <mkdir dir="${install_jar_dir}"/>
        <copy file="${dist}/${freeguideversion}-Linux-NoXMLTV.jar"
            tofile="${install_jar_dir}/FreeGuide.jar" />

        <mkdir dir="${install_doc_dir}" />        
        <copy todir="${install_doc_dir}/" >
            <fileset dir="${doc}">
                <include name="*" />
                <exclude name="uploadweb.sh" />
                <exclude name="VERSION.php" />
            </fileset>
        </copy>

        <mkdir dir="${install_pixmap_dir}" />
        <copy todir="${install_pixmap_dir}/" >
            <fileset dir="${src}/images">
                <include name="logo-*.png" />
                <exclude name="logo-192x192.png" />
                <exclude name="logo-256x256.png" />
            </fileset>
        </copy>
        
        <mkdir dir="${install_bin_dir}" />
        <echo file="${install_bin_dir}/freeguide-tv" >
#!/bin/bash
java -jar ${real_install_share_dir}/freeguide-tv/FreeGuide.jar --prefs "misc.install_directory=${real_install_share_dir}/freeguide-tv"
        </echo>
        
        <mkdir dir="${install_share_dir}/applications" />
        <echo file="${install_share_dir}/applications/freeguide-tv.desktop" >
[Desktop Entry]
Name=FreeGuide TV Guide

Encoding=UTF-8
Version=1.0

Type=Application
Categories=Application;Utility

Exec=freeguide-tv

Icon=${real_install_share_dir}/pixmaps/freeguide-tv/logo-16x16.png
        </echo>
        
        <chmod file="${install_bin_dir}/freeguide-tv" perm="a+x" />
        
    </target>
    
  	<target name="compile" depends="init" description="compile the source " >

  		<!-- compile the program -->
		<javac srcdir="${src}/program" destdir="${build}/program"/>

  		<!-- Copy in the required images -->
  		<copy todir="${build}/program" file="${src}/images/logo-256x256.png" />

		<!-- so we can overwrite files outside the doc tree -->
		<!--<copy todir="${build}/doc">
			<fileset dir="${doc}/" excludes="*.sh,*.php,.xvpics/,nonlocal/" />
		</copy>-->
        
	</target>

    <target name="FreeGuide-Win" depends="compile"
			description="generate the windows jar file" >

        <mkdir dir="${build}/windows" />
        
        <!-- Copy the program jar -->
		<copy todir="${build}/windows">
            <fileset dir="${build}/program" />
		</copy>

		<!-- Copy the XMLTV DTD -->
		<copy file="${xmltv}/xmltv.dtd" todir="${build}/windows"/>

		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/windows/install-win-all.props" tofile="${build}/windows/install-all.props" overwrite="true" />
        
        <!-- Denmark -->
		<copy file="${src}/install/windows/install-win-dk.props" tofile="${build}/windows/install-0.props" overwrite="true" />
        
        <!-- Finland -->
		<copy file="${src}/install/windows/install-win-fi.props" tofile="${build}/windows/install-1.props" overwrite="true" />
        
        <!-- France -->
        <copy file="${src}/install/windows/install-win-fr.props" tofile="${build}/windows/install-2.props" overwrite="true" />
        
        <!-- Germany -->
        <copy file="${src}/install/windows/install-win-de_tvtoday.props" tofile="${build}/windows/install-3.props" overwrite="true" />
        
        <!-- Hungary and Romania -->
		<copy file="${src}/install/windows/install-win-huro.props" tofile="${build}/windows/install-4.props" overwrite="true" />
        
        <!-- Italy -->
		<copy file="${src}/install/windows/install-win-it.props" tofile="${build}/windows/install-5.props" overwrite="true" />
        
        <!-- Japan -->
        <copy file="${src}/install/windows/install-win-jp.props" tofile="${build}/windows/install-6.props" overwrite="true" />
        
        <!-- Netherlands -->
        <copy file="${src}/install/windows/install-win-nl.props" tofile="${build}/windows/install-7.props" overwrite="true" />
        <copy file="${src}/install/windows/install-win-nl_wolf.props"
        tofile="${build}/windows/install-8.props" overwrite="true" />
        
        <!-- North America -->
        <copy file="${src}/install/windows/install-win-na_dd.props" tofile="${build}/windows/install-9.props" overwrite="true" />
        
        <!-- Norway -->
        <copy file="${src}/install/windows/install-win-no.props" tofile="${build}/windows/install-10.props" overwrite="true" />
        
        <!-- Portugal -->
        <copy file="${src}/install/windows/install-win-pt.props" tofile="${build}/windows/install-11.props" overwrite="true" />
        
        <!-- Spain -->
		<copy file="${src}/install/windows/install-win-es.props" tofile="${build}/windows/install-12.props" overwrite="true" />
        <copy file="${src}/install/windows/install-win-es_digital.props" tofile="${build}/windows/install-13.props" overwrite="true" />
        
        <!-- Sweden -->
        <copy file="${src}/install/windows/install-win-se.props" tofile="${build}/windows/install-14.props" overwrite="true" />
        
        <!-- UK -->
        <copy file="${src}/install/windows/install-win-uk_bleb.props" tofile="${build}/windows/install-15.props" overwrite="true" />
		<copy file="${src}/install/windows/install-win-uk_rt.props" tofile="${build}/windows/install-16.props" overwrite="true" />
		<copy file="${src}/install/windows/install-win-uk_rt-slow.props" tofile="${build}/windows/install-17.props" overwrite="true" />

		<!-- Make the jar installer file -->
		<jar 	jarfile="${dist}/${freeguideversion}-Win.jar"
				basedir="${build}/windows"
				manifest="${src}/manifests/FreeGuide.mf"/>
        
  	</target>

	<target name="FreeGuide-Linux-NoXMLTV" depends="compile"
  		description="generate the linux jar" >

		<mkdir dir="${build}/linux" />

		<!-- Copy the program file and docs -->
		<copy todir="${build}/linux">
            <fileset dir="${build}/program"/>
			<fileset dir="${build}/doc/" excludes="nonlocal/" />
		</copy>

		<!-- Copy the XMLTV DTD -->
		<copy file="${xmltv}/xmltv.dtd" todir="${build}/linux" />

		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/linux/install-lin-all.props" tofile="${build}/linux/install-all.props" overwrite="true" />
        
        <!-- Denmark -->
		<copy file="${src}/install/linux/install-lin-dk.props" tofile="${build}/linux/install-0.props" overwrite="true" />
        
        <!-- Finland -->
		<copy file="${src}/install/linux/install-lin-fi.props" tofile="${build}/linux/install-1.props" overwrite="true" />
        
        <!-- France -->
        <copy file="${src}/install/linux/install-lin-fr.props" tofile="${build}/linux/install-2.props" overwrite="true" />
        
        <!-- Germany -->
        <copy file="${src}/install/linux/install-lin-de_tvtoday.props" tofile="${build}/linux/install-3.props" overwrite="true" />
        
        <!-- Hungary and Romania -->
		<copy file="${src}/install/linux/install-lin-huro.props" tofile="${build}/linux/install-4.props" overwrite="true" />
        
        <!-- Italy -->
		<copy file="${src}/install/linux/install-lin-it.props" tofile="${build}/linux/install-5.props" overwrite="true" />
        
        <!-- Japan -->
        <copy file="${src}/install/linux/install-lin-jp.props" tofile="${build}/linux/install-6.props" overwrite="true" />
        
        <!-- Netherlands -->
		<copy file="${src}/install/linux/install-lin-nl.props" tofile="${build}/linux/install-7.props" overwrite="true" />
        <copy file="${src}/install/linux/install-lin-nl_wolf.props" tofile="${build}/linux/install-8.props" overwrite="true" />
        
        <!-- North America -->
		<copy file="${src}/install/linux/install-lin-na_dd.props" tofile="${build}/linux/install-9.props" overwrite="true" />
        
        <!-- Norway -->
		<copy file="${src}/install/linux/install-lin-no.props" tofile="${build}/linux/install-10.props" overwrite="true" />
        
        <!-- Portugal -->
        <copy file="${src}/install/linux/install-lin-pt.props" tofile="${build}/linux/install-11.props" overwrite="true" />
        
        <!-- Spain -->
		<copy file="${src}/install/linux/install-lin-es.props" tofile="${build}/linux/install-12.props" overwrite="true" />
        <copy file="${src}/install/linux/install-lin-es_digital.props" tofile="${build}/linux/install-13.props" overwrite="true" />
        
        <!-- Sweden -->
        <copy file="${src}/install/linux/install-lin-se.props" tofile="${build}/linux/install-14.props" overwrite="true" />
        
        <!-- UK -->
        <copy file="${src}/install/linux/install-lin-uk_bleb.props" tofile="${build}/linux/install-15.props" overwrite="true" />
		<copy file="${src}/install/linux/install-lin-uk_rt.props" tofile="${build}/linux/install-16.props" overwrite="true" />
		<copy file="${src}/install/linux/install-lin-uk_rt-slow.props" tofile="${build}/linux/install-17.props" overwrite="true" />

		<!-- Make the jar installer file -->
		<jar 	jarfile="${dist}/${freeguideversion}-Linux-NoXMLTV.jar"
				basedir="${build}/linux"
				manifest="${src}/manifests/FreeGuide.mf"/>

  	</target>

	<target name="FreeGuide-Source"
  		description="generate the source zips"
			depends="FreeGuide-Win,
					 FreeGuide-Linux-NoXMLTV">

		<zip zipfile="${dist}/${freeguideversion}.zip">
			<zipfileset dir="${src}" prefix="${freeguideversion}/src">
				<exclude name="**/.xvpics/**" />
			</zipfileset>
			<zipfileset dir="${doc}" prefix="${freeguideversion}/doc">
				<exclude name="**/.xvpics/**" />
			</zipfileset>
			<zipfileset dir="." includes="build.xml" prefix="${freeguideversion}" />
			<zipfileset dir="xmltv"
				includes="*"
				excludes="CVS/**"
				prefix="${freeguideversion}/xmltv" />
			<zipfileset dir="stats"
				includes="*.sh,*.pl"
				prefix="${freeguideversion}/stats" />
		</zip>

		<tar tarfile="${build}/fg.tar"
			 basedir="."
			 includes="build.xml,src/**,doc/**,xmltv/*,stats/*.sh,stats/*.pl"
			 excludes="**/.xvpics/**,**/CVS/**" />

		<mkdir dir="${build}/${freeguideversion}" />

		<untar dest="${build}/${freeguideversion}" src="${build}/fg.tar"/>

		<tar tarfile="${build}/${freeguideversion}.tar" basedir="${build}"
			includes="${freeguideversion}/**" />

  		<gzip src="${build}/${freeguideversion}.tar" zipfile="${dist}/${freeguideversion}.tar.gz" />

	</target>

	<target name="main" depends="FreeGuide-Source"
		description="generate all the installers" >

	</target>

	<!--<target name="doc-nonlocal" depends="init"
		description="generate the website documentation" >
                <copy todir="${build}/doc/nonlocal">
			<fileset dir="${doc}/" excludes="*.sh,*.php,.xvpics/,nonlocal/" />
		</copy>
                <copy todir="${build}/doc/nonlocal">
			<fileset dir="${doc}/nonlocal" excludes="*.sh,*.php,.xvpics/" />
		</copy>
	</target>-->

	<target name="clean"
        description="clean up" >
		<!-- Delete the ${build} and ${dist} directory trees -->
		<delete dir="${build}" />
		<delete dir="${dist}" />
	</target>

</project>

