<?xml version="1.0"?>

<project name="freeguide-tv" default="main" basedir=".">

    <description>
        Ant build file for freeguide-tv
    </description>

	<!-- set global properties for this build -->
	<property name="src" location="src"/>
	<property name="doc"  location="doc"/>
	<property name="xmltv"  location="xmltv"/>
	<property name="share"  location="xmltv/share"/>

	<property name="build" location="build"/>
	<property name="package" location="package"/>
	<property name="dist"  location="dist"/>

	<property name="freeguideversion"  value="FreeGuide-0.7.5"/>

  	<target name="init">

    	<!-- Create the time stamp -->
    	<tstamp/>
    	<!-- Create the build directory structure used by compile -->
    	<mkdir dir="${build}"/>
		<mkdir dir="${build}/program"/>
		<mkdir dir="${build}/install"/>
		<mkdir dir="${build}/doc"/>
		<mkdir dir="${package}"/>
		<mkdir dir="${dist}"/>

	</target>

  	<target name="compile" depends="init" description="compile the source " >

  		<!-- compile the program -->
		<javac srcdir="${src}/program" destdir="${build}/program"/>

  		<!-- Copy in the required images -->
  		<copy todir="${build}/program">
			<fileset dir="${src}/images">
				<include name="*.png" />
			</fileset>
		</copy>

  		<!-- copy the program classes that are needed by each installer -->
    	<copy todir="${build}/install">
			<fileset dir="${build}/program">
				<include name="*.class"/>
			</fileset>
		</copy>

		<!-- compile the installer -->
    	<javac srcdir="${src}/install" destdir="${build}/install"/>

		<!-- so we can overwrite files outside the doc tree -->
		<copy todir="${build}/doc">
			<fileset dir="${doc}/" excludes="*.sh,*.php,.xvpics/,nonlocal/" />
		</copy>
	</target>

  	<target name="FreeGuide" depends="compile"
			description="generate the program jar file" >

		<jar 	jarfile="${build}/FreeGuide.jar"
				basedir="${build}/program"
				manifest="${src}/manifests/FreeGuide.mf"/>

  	</target>

	<target name="FreeGuide-Win-Install" depends="FreeGuide"
  		description="generate the windows installer jar" >

		<mkdir dir="${package}/windows" />

		<!-- Copy the program jar, installer clases and docs -->
		<copy todir="${package}/windows">
			<fileset dir="${build}/">
				<include name="FreeGuide.jar"/>
			</fileset>
			<fileset dir="${build}/doc/" excludes="nonlocal/" />
			<fileset dir="${build}/install"/>
		</copy>

		<!-- Copy the XMLTV DTD -->
		<copy file="${xmltv}/xmltv.dtd" todir="${package}/windows"/>

		<!-- Copy the XMLTV exe -->
		<copy file="${xmltv}/xmltv.exe" todir="${package}/windows"/>

		<!-- copy in the shared files -->
		<mkdir dir="${package}/windows/share"/>
		<copy todir="${package}/windows/share">
			<fileset dir="${share}/" />
		</copy>

		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/windows/install-win-all.props" tofile="${package}/windows/install-all.props" overwrite="true" />
        
        <!-- Denmark -->
		<copy file="${src}/install/windows/install-win-dk.props" tofile="${package}/windows/install-0.props" overwrite="true" />
        
        <!-- Finland -->
		<copy file="${src}/install/windows/install-win-fi.props" tofile="${package}/windows/install-1.props" overwrite="true" />
        
        <!-- France -->
        <copy file="${src}/install/windows/install-win-fr.props" tofile="${package}/windows/install-2.props" overwrite="true" />
        
        <!-- Germany -->
        <copy file="${src}/install/windows/install-win-de_tvtoday.props" tofile="${package}/windows/install-3.props" overwrite="true" />
        
        <!-- Hungary and Romania -->
		<copy file="${src}/install/windows/install-win-huro.props" tofile="${package}/windows/install-4.props" overwrite="true" />
        
        <!-- Italy -->
		<copy file="${src}/install/windows/install-win-it.props" tofile="${package}/windows/install-5.props" overwrite="true" />
        
        <!-- Japan -->
        <copy file="${src}/install/windows/install-win-jp.props" tofile="${package}/windows/install-6.props" overwrite="true" />
        
        <!-- Netherlands -->
        <copy file="${src}/install/windows/install-win-nl.props" tofile="${package}/windows/install-7.props" overwrite="true" />
        <copy file="${src}/install/windows/install-win-nl_wolf.props"
        tofile="${package}/windows/install-8.props" overwrite="true" />
        
        <!-- North America -->
        <copy file="${src}/install/windows/install-win-na_dd.props" tofile="${package}/windows/install-9.props" overwrite="true" />
        
        <!-- Norway -->
        <copy file="${src}/install/windows/install-win-no.props" tofile="${package}/windows/install-10.props" overwrite="true" />
        
        <!-- Portugal -->
        <copy file="${src}/install/windows/install-win-pt.props" tofile="${package}/windows/install-11.props" overwrite="true" />
        
        <!-- Spain -->
		<copy file="${src}/install/windows/install-win-es.props" tofile="${package}/windows/install-12.props" overwrite="true" />
        <copy file="${src}/install/windows/install-win-es_digital.props" tofile="${package}/windows/install-13.props" overwrite="true" />
        
        <!-- Sweden -->
        <copy file="${src}/install/windows/install-win-se.props" tofile="${package}/windows/install-14.props" overwrite="true" />
        
        <!-- UK -->
        <copy file="${src}/install/windows/install-win-uk_bleb.props" tofile="${package}/windows/install-15.props" overwrite="true" />
		<copy file="${src}/install/windows/install-win-uk_rt.props" tofile="${package}/windows/install-16.props" overwrite="true" />
		<copy file="${src}/install/windows/install-win-uk_rt-slow.props" tofile="${package}/windows/install-17.props" overwrite="true" />

		<!-- Make the jar installer file -->
		<jar 	jarfile="${dist}/${freeguideversion}-Win-Install.jar"
				basedir="${package}/windows"
				manifest="${src}/manifests/Install.mf"/>

  	</target>



	<target name="FreeGuide-Linux-NoXMLTV-Install" depends="FreeGuide"
  		description="generate the linux installer jar" >

		<mkdir dir="${package}/linux" />

		<!-- Copy the program file and docs -->
		<copy todir="${package}/linux">
			<fileset dir="${build}/">
				<include name="FreeGuide.jar"/>
			</fileset>
			<fileset dir="${build}/doc/" excludes="nonlocal/" />
			<fileset dir="${build}/install"/>
		</copy>

		<!-- Copy the XMLTV DTD -->
		<copy file="${xmltv}/xmltv.dtd" todir="${package}/linux" />

		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/linux/install-lin-all.props" tofile="${package}/linux/install-all.props" overwrite="true" />
        
        <!-- Denmark -->
		<copy file="${src}/install/linux/install-lin-dk.props" tofile="${package}/linux/install-0.props" overwrite="true" />
        
        <!-- Finaland -->
		<copy file="${src}/install/linux/install-lin-fi.props" tofile="${package}/linux/install-1.props" overwrite="true" />
        
        <!-- France -->
        <copy file="${src}/install/linux/install-lin-fr.props" tofile="${package}/linux/install-2.props" overwrite="true" />
        
        <!-- Germany -->
        <copy file="${src}/install/linux/install-lin-de_tvtoday.props" tofile="${package}/linux/install-3.props" overwrite="true" />
        
        <!-- Hungary and Romania -->
		<copy file="${src}/install/linux/install-lin-huro.props" tofile="${package}/linux/install-4.props" overwrite="true" />
        
        <!-- Italy -->
		<copy file="${src}/install/linux/install-lin-it.props" tofile="${package}/linux/install-5.props" overwrite="true" />
        
        <!-- Japan -->
        <copy file="${src}/install/linux/install-lin-jp.props" tofile="${package}/linux/install-6.props" overwrite="true" />
        
        <!-- Netherlands -->
		<copy file="${src}/install/linux/install-lin-nl.props" tofile="${package}/linux/install-7.props" overwrite="true" />
        <copy file="${src}/install/linux/install-lin-nl_wolf.props" tofile="${package}/linux/install-8.props" overwrite="true" />
        
        <!-- Norway -->
		<copy file="${src}/install/linux/install-lin-no.props" tofile="${package}/linux/install-9.props" overwrite="true" />
        
        <!-- Portugal -->
        <copy file="${src}/install/linux/install-lin-pt.props" tofile="${package}/linux/install-10.props" overwrite="true" />
        
        <!-- Spain -->
		<copy file="${src}/install/linux/install-lin-es.props" tofile="${package}/linux/install-11.props" overwrite="true" />
        <copy file="${src}/install/linux/install-lin-es_digital.props" tofile="${package}/linux/install-12.props" overwrite="true" />
        
        <!-- Sweden -->
        <copy file="${src}/install/linux/install-lin-se.props" tofile="${package}/linux/install-13.props" overwrite="true" />
        
        <!-- North America -->
		<copy file="${src}/install/linux/install-lin-na_dd.props" tofile="${package}/linux/install-14.props" overwrite="true" />
        
        <!-- UK -->
        <copy file="${src}/install/linux/install-lin-uk_bleb.props" tofile="${package}/linux/install-15.props" overwrite="true" />
		<copy file="${src}/install/linux/install-lin-uk_rt.props" tofile="${package}/linux/install-16.props" overwrite="true" />
		<copy file="${src}/install/linux/install-lin-uk_rt-slow.props" tofile="${package}/linux/install-17.props" overwrite="true" />

		<!-- Make the jar installer file -->
		<jar 	jarfile="${dist}/${freeguideversion}-Linux-NoXMLTV-Install.jar"
				basedir="${package}/linux"
				manifest="${src}/manifests/Install.mf"/>

  	</target>

	<target name="FreeGuide-Linux-Install" depends="FreeGuide"
  		description="generate the linux installer including the PAR version of XMLTV" >

		<mkdir dir="${package}/linux-par" />

		<!-- Copy the program file and docs -->
		<copy todir="${package}/linux-par">
			<fileset dir="${build}/">
				<include name="FreeGuide.jar"/>
			</fileset>
			<fileset dir="${build}/doc/" excludes="nonlocal/" />
			<fileset dir="${build}/install"/>
		</copy>

		<!-- Copy the XMLTV DTD -->
		<copy file="${xmltv}/xmltv.dtd" todir="${package}/linux-par" />

		<!-- Copy the XMLTV PAR-compiled executable -->
		<copy file="${xmltv}/xmltv" todir="${package}/linux-par"/>

		<!-- copy in the shared files -->
		<mkdir dir="${package}/linux-par/share"/>
		<copy todir="${package}/linux-par/share">
			<fileset dir="${share}/" />
		</copy>

		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/linux-par/install-lin-all.props" tofile="${package}/linux-par/install-all.props" overwrite="true" />
		<copy file="${src}/install/linux-par/install-lin-dk.props" tofile="${package}/linux-par/install-0.props" overwrite="true" />

		<!-- Make the jar installer file -->
		<jar 	jarfile="${dist}/${freeguideversion}-Linux-Install.jar"
				basedir="${package}/linux-par"
				manifest="${src}/manifests/Install.mf"/>

  	</target>

	<target name="FreeGuide-Source"
  		description="generate the source zips"
			depends="FreeGuide-Win-Install,
					 FreeGuide-Linux-NoXMLTV-Install">
					 <!--FreeGuide-Linux-Install,-->

		<zip zipfile="${dist}/${freeguideversion}.zip">
			<zipfileset dir="${src}" prefix="${freeguideversion}/src">
				<exclude name="**/.xvpics/**" />
			</zipfileset>
			<zipfileset dir="${doc}" prefix="${freeguideversion}/doc">
				<exclude name="**/.xvpics/**" />
			</zipfileset>
			<zipfileset dir="." includes="build.xml" prefix="${freeguideversion}" />
			<zipfileset dir="xmltv"
				includes="*"
				excludes="CVS/**,xmltv,xmltv.exe,xmltv.dtd,*-bin-*"
				prefix="${freeguideversion}/xmltv" />
			<zipfileset dir="stats"
				includes="*.sh,*.pl"
				prefix="${freeguideversion}/stats" />
		</zip>

		<tar tarfile="${package}/fg.tar"
			 basedir="."
			 includes="build.xml,src/**,doc/**,xmltv/*,stats/*.sh,stats/*.pl"
			 excludes="**/.xvpics/**,**/CVS/**,xmltv/xmltv,xmltv/xmltv.exe,xmltv/xmltv.dtd,xmltv/**-bin-**" />

		<mkdir dir="${package}/${freeguideversion}" />

		<untar dest="${package}/${freeguideversion}" src="${package}/fg.tar"/>

		<tar tarfile="${package}/${freeguideversion}.tar" basedir="${package}"
			includes="${freeguideversion}/**" />

  		<gzip src="${package}/${freeguideversion}.tar" zipfile="${dist}/${freeguideversion}.tar.gz" />

	</target>

	<target name="main" depends="FreeGuide-Source"
		description="generate all the installers" >

	</target>

	<target name="doc-nonlocal" depends="init"
		description="generate the website documentation" >
                <copy todir="${build}/doc/nonlocal">
			<fileset dir="${doc}/" excludes="*.sh,*.php,.xvpics/,nonlocal/" />
		</copy>
                <copy todir="${build}/doc/nonlocal">
			<fileset dir="${doc}/nonlocal" excludes="*.sh,*.php,.xvpics/" />
		</copy>
	</target>


	<target name="clean"
        description="clean up" >
		<!-- Delete the ${build}, ${dist} and ${package} directory trees -->
		<delete dir="${build}" />
		<delete dir="${dist}" />
		<delete dir="${package}" />
	</target>

</project>

