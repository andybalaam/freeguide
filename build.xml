<?xml version="1.0"?>

<project name="cvs-freeguide-tv" default="main" basedir=".">
    <description>
        Ant build file for freeguide-tv
    </description>
	
	<!-- set global properties for this build -->
	<property name="src" location="src"/>
	<property name="doc"  location="doc"/>
	<property name="xmltv"  location="xmltv"/>
	<property name="share"  location="share"/>
	
	<property name="build" location="build"/>
	<property name="dist"  location="dist"/>

	<property name="freeguideversion"  value="FreeGuide-0_4_4"/>
	
  	<target name="init">
  
    	<!-- Create the time stamp -->
    	<tstamp/>
    	<!-- Create the build directory structure used by compile -->
    	<mkdir dir="${build}"/>
		<mkdir dir="${build}/program"/>
		<mkdir dir="${build}/install"/>
		<mkdir dir="${dist}"/>
	
	</target>

  	<target name="compile" depends="init" description="compile the source " >
  
  		<!-- compile the program -->
		<javac srcdir="${src}/program" destdir="${build}/program"/>  
  
  		<!-- copy the program classes that are needed by each installer -->
    	<copy todir="${build}/install">
			<fileset dir="${build}/program">
				<include name="FreeGuideAbstractFileWizardPanel*.class"/>
				<include name="FreeGuideConfigGuesser.class"/>
				<include name="FreeGuideDirectoryWizardPanel*.class"/>
				<include name="FreeGuideEnvironmentChecker.class"/>
				<include name="FreeGuideLabelWizardPanel*.class"/>
				<include name="FreeGuideLauncher.class"/>
				<include name="FreeGuidePreferencesGroup.class"/>
				<include name="FreeGuidePreferences.class"/>
				<include name="FreeGuideTime.class"/>
				<include name="FreeGuideWizard*.class"/>
				<include name="FreeGuideWizardPanel*.class"/>
			</fileset>
		</copy>
	
		<!-- compile the installer -->
    	<javac srcdir="${src}/install" destdir="${build}/install"/>
	
		<!-- process the documentation -->
		<!-- FIXME - this makes the build process fail on Windows as these
			text files are not created -->
		<exec executable="lynx" dir="${doc}" os="Linux" output="${doc}/README">
			<arg value="-dump"/>
			<arg value="-nolist"/>
			<arg value="README.html"/>
		</exec>
		<exec executable="lynx" dir="${doc}" os="Linux" output="${doc}/INSTALL">
			<arg value="-dump"/>
			<arg value="-nolist"/>
			<arg value="INSTALL-linux.html"/>
		</exec>
	
	</target>

  	<target name="FreeGuide" depends="compile" description="generate the program jar file" >
  
  		<mkdir dir="${dist}"/>
				
		<jar 	jarfile="${dist}/FreeGuide.jar"
				basedir="${build}/program"
				manifest="${src}/manifests/FreeGuide.mf"/>
  
  	</target>

  
  	<target name="FreeGuide-Win-UK-Install" depends="FreeGuide" 
  		description="generate the windows uk installer jar" >
		
		<mkdir dir="${build}/install-win-uk"/>
		
		<!-- Copy the program jar, installer clases and docs -->
		<copy todir="${build}/install-win-uk">
			<fileset dir="${dist}/">
				<include name="FreeGuide.jar"/>
			</fileset>
			<fileset dir="${doc}/">
				<exclude name="*.sh"/>
			</fileset>
			<fileset dir="${build}/install"/>
		</copy>
		
		<!-- Copy the XMLTV DTD -->
		<mkdir dir="${build}/install-win-uk/data"/>
		<copy file="${xmltv}/xmltv.dtd" todir="${build}/install-win-uk/data"/>
		
		<!-- Copy the XMLTV exes -->
		<mkdir dir="${build}/install-win-uk/xmltv"/>
		<copy todir="${build}/install-win-uk/xmltv">
			<fileset dir="${xmltv}/">
				<include name="tv_split.exe"/>
				<include name="tv_grab_uk.exe"/>
				<include name="perl56.dll"/>
			</fileset>
		</copy>
		
		<!-- copy in the shared files -->
		<mkdir dir="${build}/install-win-uk/share"/>
		<copy todir="${build}/install-win-uk/share">
			<fileset dir="${share}/" />
		</copy>
		
		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/install-win-uk.props" tofile="${build}/install-win-uk/install.props" />
		
		<!-- Make the jar installer file -->
		<jar 	jarfile="${dist}/${freeguideversion}-Win-UK-Install.jar"
				basedir="${build}/install-win-uk"
				manifest="${src}/manifests/FreeGuideInstall.mf"/>
  
  	</target>
  
  	<target name="FreeGuide-Win-NA-Install" depends="FreeGuide" 
  		description="generate the windows north american installer jar" >
		
		<!-- Copy the program file and docs -->
		<copy todir="${build}/install-win-na">
			<fileset dir="${dist}/">
				<include name="FreeGuide.jar"/>
			</fileset>
			<fileset dir="${doc}/">
				<exclude name="*.sh"/>
			</fileset>
			<fileset dir="${build}/install"/>
		</copy>
		
		<!-- Copy the XMLTV DTD -->
		<mkdir dir="${build}/install-win-na/data"/>
		<copy file="${xmltv}/xmltv.dtd" todir="${build}/install-win-na/data"/>
		
		<!-- Copy the XMLTV exes -->
		<mkdir dir="${build}/install-win-na/xmltv"/>
		<copy todir="${build}/install-win-na/xmltv">
			<fileset dir="${xmltv}/">
				<include name="tv_split.exe"/>
				<include name="tv_grab_na.exe"/>
				<include name="perl56.dll"/>
			</fileset>
		</copy>
		
		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/install-win-na.props" tofile="${build}/install-win-na/install.props" />
		
		<jar 	jarfile="${dist}/${freeguideversion}-Win-NA-Install.jar"
				basedir="${build}/install-win-na"
				manifest="${src}/manifests/FreeGuideInstall.mf"/>
  
  	</target>
  
  	<target name="FreeGuide-Linux-UK-Install" depends="FreeGuide" 
  		description="generate the linux uk installer jar" >
		
		<!-- Copy the program file and docs -->
		<copy todir="${build}/install-lin-uk">
			<fileset dir="${dist}/">
				<include name="FreeGuide.jar"/>
			</fileset>
			<fileset dir="${doc}/">
				<exclude name="*.sh"/>
			</fileset>
			<fileset dir="${build}/install"/>
		</copy>
		
		<!-- Copy the XMLTV DTD -->
		<mkdir dir="${build}/install-lin-uk/data"/>
		<copy file="${xmltv}/xmltv.dtd" todir="${build}/install-lin-uk/data"/>
		
		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/install-lin-uk.props" tofile="${build}/install-lin-uk/install.props" overwrite="true" />
		
		<!-- Make the jar installer file -->
		<jar 	jarfile="${dist}/${freeguideversion}-Linux-UK-Install.jar"
				basedir="${build}/install-lin-uk"
				manifest="${src}/manifests/FreeGuideInstall.mf"/>
  
  	</target>
	
	<target name="FreeGuide-Linux-NA-Install" depends="FreeGuide" 
  		description="generate the linux na installer jar" >
		
		<!-- Copy the program file and docs -->
		<copy todir="${build}/install-lin-na">
			<fileset dir="${dist}/">
				<include name="FreeGuide.jar"/>
			</fileset>
			<fileset dir="${doc}/">
				<exclude name="*.sh"/>
			</fileset>
			<fileset dir="${build}/install"/>
		</copy>
		
		<!-- Copy the XMLTV DTD -->
		<mkdir dir="${build}/install-lin-na/data"/>
		<copy file="${xmltv}/xmltv.dtd" todir="${build}/install-lin-na/data"/>
		
		<!-- copy in the install.props file for the jar -->
		<copy file="${src}/install/install-lin-na.props" tofile="${build}/install-lin-na/install.props" overwrite="true" />
		
		<!-- Make the jar installer file -->
		<jar 	jarfile="${dist}/${freeguideversion}-Linux-NA-Install.jar"
				basedir="${build}/install-lin-na"
				manifest="${src}/manifests/FreeGuideInstall.mf"/>
  
  	</target>
	
	<target name="FreeGuide-Source"
  		description="generate the source zip" depends="init">
		
		<zip zipfile="${dist}/${freeguideversion}-Source.zip">
			<zipfileset dir="${src}" prefix="src" />
			<zipfileset dir="${doc}" prefix="doc" />
			<fileset dir="." includes="build.xml" />
		</zip>
  
  	</target>
  
  	<target name="main" depends="FreeGuide-Source,FreeGuide-Win-UK-Install,FreeGuide-Win-NA-Install,FreeGuide-Linux-UK-Install,FreeGuide-Linux-NA-Install"
		description="generate all the installers" >
  
	</target>

	<target name="clean"
        description="clean up" >
		<!-- Delete the ${build} and ${dist} directory trees -->
		<delete dir="${build}"/>
		<delete dir="${dist}"/>
	</target>
		
</project>

