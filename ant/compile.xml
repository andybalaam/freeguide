<?xml version="1.0"?>

<project name="freeguide-tv-build" default="jars-lin">

    <import file="plugins-info.xml"/>
    <import file="prepare.xml"/>
    <import file="../build.xml"/>

    <target name="jars-lin" depends="prepare, compile, jar-common, jar-plugins,
        jar-startup, zip-docs"/>

    <target name="jars-win" depends="jars-lin, jar-xmltv-win"/>

    <target name="compile"
        description="Compile all the .java files into the build dir.">

        <mkdir dir="${build}/classes"/>
        <javac srcdir="${src}"
            destdir="${build}/classes"
            deprecation="on"
            source="1.5"
            target="1.5"
            debug="yes"
            encoding="UTF-8">
            <!-- Uncomment to show warnings <compilerarg value="-Xlint:unchecked"/>-->
          </javac>
    </target>

    <target name="compile-in-place" depends="prepare"
        description="Compile all the .java files inside the src dir.">

        <javac srcdir="${src}"
            deprecation="on"
            source="1.5"
            target="1.5"
            debug="yes"
            encoding="UTF-8">
            <!-- Uncomment to show warnings <compilerarg value="-Xlint:unchecked"/>-->
          </javac>

    </target>

    <target name="jar-common">
        <!-- Create the common.jar file -->
        <mkdir dir="${build}/package/lib"/>

        <jar jarfile="${build}/package/lib/common.jar"
                basedir="${build}/classes"
                includes="freeguide/common/**">
             <fileset dir="${src}" includes="resources/main/*"/>
             <fileset dir="${src}" includes="resources/i18n/*"/>
        </jar>
    </target>

    <!-- Zip the HTML documentation into the lib dir -->
    <target name="zip-docs">
        <mkdir dir="${build}/package/lib"/>
        <zip zipfile="${build}/package/lib/docs.zip">
            <fileset dir="${doc}/html-local"/>
        </zip>
    </target>

    <target name="jar-xmltv-win">
        <mkdir dir="${build}/other-xmltv-win/other/xmltv-win/"/>
        <copy todir="${build}/other-xmltv-win/other/xmltv-win/">
            <fileset dir="${xmltv}"/>
        </copy>
        <jar jarfile="${build}/package/lib/xmltv-win.jar" basedir="${build}/other-xmltv-win"/>
    </target>

    <target name="jar-plugins">
        <antcall target="all-plugins">
            <param name="actual-target" value="subtask-jar-one-plugin"/>
        </antcall>
    </target>

    <target name="subtask-jar-one-plugin">

        <mkdir dir="${build}/package/lib"/>

        <!-- TODO: remove the following line and make it still work! -->
        <mkdir dir="${src}/freeguide/plugins/${plugin-dir}"/>

        <!-- Build the JAR file for this plugin -->
        <jar jarfile="${build}/package/lib/${plugin-id}.jar">
            <fileset dir="${build}/classes" includes="freeguide/plugins/${plugin-dir}/**"/>
            <fileset dir="${src}" includes="resources/plugins/${plugin-dir}/**"/>
            <fileset dir="${src}/freeguide/plugins/${plugin-dir}"
                includes="plugin.xml"/>
        </jar>

    </target>

    <target name="jar-startup">
        <mkdir dir="${build}/package/lib"/>
        <jar jarfile="${build}/package/startup.jar"
             basedir="${build}/classes"
             includes="freeguide/startup/**"
             manifest="${src}/resources/manifests/startup.mf" />
    </target>

</project>

