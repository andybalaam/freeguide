<?xml version="1.0"?>
<!-- Tasks for prepare build, i.e. for change application and
     plugins info in the all files.
     Also converts utf-8 properties files into java-ascii ones
-->

<project name="freeguide-tv-prebuild" default="prepare">
    <!-- import the variables -->
    <import file="../build.xml"/>

    <target name="prebuild-buildclasses">

        <mkdir dir="${build}/buildclasses"/>

        <javac
            source="1.5"
            target="1.5"
            destdir="${build}/buildclasses">
            <src path="${src}"/>
            <classpath>
                <fileset dir="${lib}" includes="**/*.jar"/>
            </classpath>
            <!-- Uncomment to show warnings <compilerarg value="-Xlint:unchecked"/>-->
        </javac>
    </target>


   <target name="prepare-properties"
        description="Converts the utf-8 properties files with the
         native 2ascii tool to a format java understands">

        <native2ascii encoding="UTF-8"
            src="${resources-utf8}"
            dest="${resources}"
            includes="**/*.properties">
<!--            includes="*.properties.utf-8">-->
<!--            <mapper type="glob" from="*.properties.utf-8" to="*.properties"/>-->
        </native2ascii>

        <!-- the utf-8 files contain a comment line that indicate
                a utf-8 encoding. This shall be changed to ascii -->
        <replaceregexp byline="true">
            <regexp pattern="#encoding: utf-8"/>
            <substitution expression="#encoding: ascii"/>
            <fileset dir="${resources}" includes="**/*.properties" />
        </replaceregexp>
    </target>


    <target name="prepare" depends="prepare-properties,prebuild-buildclasses">
        <java classpath="${build}/buildclasses"
        classname="freeguide.build.patchallfiles.PatchAllFiles"
        fork="true"/>
    </target>


    <taskdef name="jalopy" classname="de.hunsicker.jalopy.plugin.ant.AntPlugin">
        <classpath>
            <fileset dir="ant/tasks" includes="*.jar"/>
        </classpath>
    </taskdef>

</project>
